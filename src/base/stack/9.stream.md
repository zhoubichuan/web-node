---
lang: zh-CN
sidebarDepth: 2
meta:
  - name: description
    content: 个人总结的vuepress学习技术文档-语法
  - name: keywords
    content: vuepress,最新技术文档,vuepress语法,markdown语法
---

# 九.Stream

## 1.流的概念

- 流是一组有序的，有起点和终点的字节数据传输手段
- 它不关心文件的整体内容，只关注是否从文件中读到了数据，以及读到数据之后的处理
- 流是一个抽象接口，被 Node 中的很多对象所实现。比如 HTTP 服务器 request 和 response 对象都是流

## 2.可读流 createReadStream

实现了`stream.Readable`接口的对象，将对象数据读取为流数据，当监听 data 事件后，开始发射数据

```js
fs.createReadStream = function(path, options) {
  return new ReadStream(path, options)
}
utils.inherits(ReadStream, Readable)
```

### 2.1 创建可读流

```js
var rs = fs.createReadStream(path, [options])
```

- 1.path 读取文件的路径
- 2. options

  - flags 打开文件要做的操作，默认为`r`
  - encoding 默认为 null
  - start 开始读取的索引位置
  - end 结束肚脐的索引位置
  - highWaterMark 读取缓存区默认的大小 64kb

::: tip 提示
如果指定 utf8 编码 highWaterMark 要大于 3 个字节
:::
### 2.2 监听data事件
流切换到流动模式，数据会被尽可能快的读出
```js
rs.on('data',function(data){
  console.log(data)
})
```
### 2.3 监听end事件
该事件会在读完数据后被触发
```js
rs.on('end',function(){
  console.log('读取完成')
})
```
### 2.4 监听error事件
```js
rs.on('error',function(err){
  console.log(err)
})
```
### 2.5 监听open事件
```js
rs.on('open',function(){
  console.log('open')
})
```
### 2.6 监听close事件
```js
rs.on('close',function(){
  console.log('close')
})
```
### 2.7 设置编码
与指定{encoding:'utf8'}效果相同，设置编码
```js
rs.setEncoding('utf8')
```
### 2.8 暂停和恢复触发data
通过pause()方法和resume()方法
```js
rs.on('data',function(data){
  rs.pause()
  console.log(data)
})
setTimeout(function(){
  rs.resume()
},2000)
```
## 3.可写流createWriteStream
实现了stream.Writable接口的对象将流数据写入到对象中
```js
fs.createWriteStream = function(path, options){
  return new WriteStream(path,options)
}
util.inherits(WriteStream, Writable)
```
